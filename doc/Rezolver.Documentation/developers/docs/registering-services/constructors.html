<!DOCTYPE html>
<!--[if IE]><![endif]-->
<html>
  
  <head>
  	<meta charset="utf-8">
  	<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
  	<title>Constructor Injection </title>
  	<meta name="viewport" content="width=device-width">
  	<meta name="title" content="Constructor Injection ">
  	<meta name="generator" content="docfx 2.12.1.0">
  	
  	<link rel="shortcut icon" href="../../favicon.ico">
  	<link rel="stylesheet" href="../../styles/docfx.vendor.css">
  	<link rel="stylesheet" href="../../styles/docfx.css">
  	<link rel="stylesheet" href="../../styles/main.css">
  	<meta property="docfx:navrel" content="../../toc.html">
  	<meta property="docfx:tocrel" content="../toc.html">
  	<meta property="docfx:rel" content="../../">
  	
  		<link rel="apple-touch-icon" sizes="57x57" href="../../../apple-touch-icon-57x57.png">
  		<link rel="apple-touch-icon" sizes="60x60" href="../../../apple-touch-icon-60x60.png">
  		<link rel="apple-touch-icon" sizes="72x72" href="../../../apple-touch-icon-72x72.png">
  		<link rel="apple-touch-icon" sizes="76x76" href="../../../apple-touch-icon-76x76.png">
  		<link rel="apple-touch-icon" sizes="114x114" href="../../../apple-touch-icon-114x114.png">
  		<link rel="apple-touch-icon" sizes="120x120" href="../../../apple-touch-icon-120x120.png">
  		<link rel="apple-touch-icon" sizes="144x144" href="../../../apple-touch-icon-144x144.png">
  		<link rel="apple-touch-icon" sizes="152x152" href="../../../apple-touch-icon-152x152.png">
  		<link rel="apple-touch-icon" sizes="180x180" href="../../../apple-touch-icon-180x180.png">
  		<link rel="icon" type="image/png" href="../../../favicon-32x32.png" sizes="32x32">
  		<link rel="icon" type="image/png" href="../../../android-chrome-192x192.png" sizes="192x192">
  		<link rel="icon" type="image/png" href="../../../favicon-96x96.png" sizes="96x96">
  		<link rel="icon" type="image/png" href="../../../favicon-16x16.png" sizes="16x16">
  		<link rel="manifest" href="../../../manifest.json">
  		<link rel="mask-icon" href="../../../safari-pinned-tab.svg" color="#5bbad5">
  		<meta name="msapplication-TileColor" content="#da532c">
  		<meta name="msapplication-TileImage" content="../../../mstile-144x144.png">
  		<meta name="theme-color" content="#ffffff">
  </head>
  <body data-spy="scroll" data-target="#affix">
    <div id="wrapper">
      <header>
        
        <nav id="autocollapse" class="navbar navbar-inverse ng-scope" role="navigation">
          <div class="container">
            <div class="navbar-header">
              <button type="button" class="navbar-toggle" data-toggle="collapse" data-target="#navbar">
                <span class="sr-only">Toggle navigation</span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
              </button>
              
              <a class="navbar-brand" href="../../index.html">
                <img id="logo" class="svg" src="../../../content/rz_square_white_on_orange_48x48.png" alt="">
              </a>
            </div>
            <div class="collapse navbar-collapse" id="navbar">
              <form class="navbar-form navbar-right" role="search" id="search">
                <div class="form-group">
                  <input type="text" class="form-control" id="search-query" placeholder="Search" autocomplete="off">
                </div>
              </form>
            </div>
          </div>
        </nav>
        
        <div class="subnav navbar navbar-default">
          <div class="container hide-when-search" id="breadcrumb">
            <ul class="breadcrumb">
              <li></li>
            </ul>
          </div>
        </div>
      </header>
      <div class="container body-content">
        
        <div id="search-results">
          <div class="search-list"></div>
          <div class="sr-items"></div>
          <ul id="pagination"></ul>
        </div>
      </div>
      <div role="main" class="container body-content hide-when-search">
        
        <div class="sidenav hide-when-search">
          <a class="btn toc-toggle collapse" data-toggle="collapse" href="#sidetoggle" aria-expanded="false" aria-controls="sidetoggle">Show / Hide Table of Contents</a>
          <div class="sidetoggle collapse" id="sidetoggle">
            <div id="sidetoc"></div>
          </div>
        </div>
        <div class="article row grid-right">
          <div class="col-md-10">
            <article class="content wrap" id="_content" data-uid="">
              <h1 id="constructor-injection">Constructor Injection</h1>
              
<p>The most basic, fundamental feature of any IOC container is the ability to create instances of services through a 
constructor, automatically injecting arguments into that constructor from the services which have been registered in
the container.</p>
<div class="TIP"><h5>Tip</h5><p>Constructor injection is achieved in Rezolver through the targets <a class="xref" href="../../api/Rezolver.Targets.ConstructorTarget.html">ConstructorTarget</a> and
<a class="xref" href="../../api/Rezolver.Targets.GenericConstructorTarget.html">GenericConstructorTarget</a> (for open generic types).  These classes can be built by hand in your code for
registration in the container, or you can use the extensions defined in 
<a class="xref" href="../../api/Rezolver.RegisterTypeTargetContainerExtensions.html">RegisterTypeTargetContainerExtensions</a>, which provides shortcuts for the most common constructor injection
scenarios.</p>
<p>Finally, there&#39;s also <a class="xref" href="../../api/Rezolver.SingletonTargetContainerExtensions.html">SingletonTargetContainerExtensions</a> and <a class="xref" href="../../api/Rezolver.ScopedTargetContainerExtensions.html">ScopedTargetContainerExtensions</a>,
which provide shortcuts for singleton and explicitly scoped constructor-injected registrations.</p>
<p>In the examples shown throughout, we use both the extension methods and target constructors.</p>
</div>
<p>So, given these types:</p>
<pre><code class="lang-csharp" name="MyService.cs">public class MyService : IMyService
{
}
</code></pre><p>and</p>
<pre><code class="lang-csharp" name="RequiresMyService.cs">public class RequiresMyService : IRequiresIMyService
{
	public MyService Service { get; }
	public RequiresMyService(MyService service)
	{
		Service = service;
	}

	public RequiresMyService(IMyService service)
	{
		if (service != typeof(MyService))
			throw new ArgumentException(nameof(service));
		Service = (MyService)service;
	}

	IMyService IRequiresIMyService.Service { get { return Service; } }
}
</code></pre><div class="NOTE"><h5>Note</h5><p>The rather silly explicit implementation and argument checking in the second constructor is purely for 
illustrative purposes!</p>
</div>
<p>In order to build <code>RequiresMyService</code> we need an instance of <code>MyService</code> or <code>IMyService</code>, so let&#39;s try injecting a
<code>MyService</code>, and resolve:</p>
<pre><code class="lang-csharp" name="Example.cs">var container = new Container();
container.RegisterType&lt;MyService&gt;();
container.RegisterType&lt;RequiresMyService&gt;();

var result = container.Resolve&lt;RequiresMyService&gt;();

Assert.NotNull(result.Service);
</code></pre><p><em>Notice that the container happily binds to one of these two constructors</em></p>
<p>Now, obviously a key facet of dependency injection is that we can depend upon an <em>abstraction</em> of a service instead of a concrete
implementation - so most of the time your constructors will request an interface instead of a concrete type.  To do this,
we simply register <code>MyService</code> against the type <code>IMyService</code>:</p>
<div class="TIP"><h5>Tip</h5><p>Remember - just because we&#39;ve registered a target which builds the type <code>MyService</code>, if we register it only against
the type <code>IMyService</code>, then that&#39;s the only type the container actually knows about.  The challenge for the container
here is to correctly identify our second constructor, which accepts an IMyService, based on the fact that that&#39;s the 
only other type we&#39;ve registered.</p>
</div>
<pre><code class="lang-csharp" name="Example.cs">var container = new Container();
container.RegisterType&lt;MyService, IMyService&gt;();
container.RegisterType&lt;RequiresMyService&gt;();

var result = container.Resolve&lt;RequiresMyService&gt;();

Assert.NotNull(result.Service);
</code></pre><p>&#39;So what?&#39; you say, &#39;it&#39;s doing exactly what I want it to!&#39;  Yes, but there&#39;s more going on here than you&#39;d think: the 
<a class="xref" href="../../api/Rezolver.Targets.ConstructorTarget.html">ConstructorTarget</a> is selecting the best-matched constructor based on the service registrations present 
in the container when it&#39;s asked to <a class="xref" href="../../api/Rezolver.IContainer.html#Rezolver_IContainer_Resolve_">Resolve</a> the object.</p>
<p>To prove that it&#39;s the <code>IMyService</code> constructor we bound there, and not the other one - let&#39;s try registering a different
implementation of <code>IMyService</code> - one which the class will not support because it&#39;ll fail the argument type check in the
second constructor:</p>
<pre><code class="lang-csharp" name="Example.cs">var container = new Container();
container.RegisterType&lt;MyAlternateService, IMyService&gt;();
container.RegisterType&lt;RequiresMyService&gt;();
//proves that the ConstructorTarget is selecting the constructor
//based on the available services.
Assert.Throws&lt;ArgumentException&gt;(&quot;service&quot;,
	() =&gt; container.Resolve&lt;RequiresMyService&gt;());
</code></pre><div class="NOTE"><h5>Note</h5><p>You can see these tests, and run them yourself, if you grab the 
<a href="https://github.com/zolutionsoftware/rezolver">Rezolver source from Github</a>, open the main solution and run
the tests in the &#39;Rezolver.Tests.Examples&#39; project.</p>
</div>
<p>So, then, let&#39;s take a deeper dive into how Rezolver binds constructors.</p>
<h1 id="types-of-constructor-binding">Types of constructor binding</h1>
<p>Some IOC containers restrict you to types which have a single constructor.  Rezolver&#39;s constructor injection, implemented by
the types <a class="xref" href="../../api/Rezolver.Targets.ConstructorTarget.html">ConstructorTarget</a> and <a class="xref" href="../../api/Rezolver.Targets.GenericConstructorTarget.html">GenericConstructorTarget</a>, are capable of binding to types
which have multiple constructors.</p>
<p>The <code>ConstructorTarget</code> actually has two modes:</p>
<ul>
<li>Find the best matching constructor</li>
<li>Explicitly-supplied constructor (where you supply a <code>ConstructorInfo</code> on creation)</li>
</ul>
<h2 id="best-match-constructor">Best match constructor</h2>
<p>The best-match algorithm is similar to how a compiler matches a method overload.  The rules aren&#39;t necessarily exactly 
the same as, say, the C# spec, but they&#39;re close.</p>
<p>Based on the services available in the container at the time the @Resolver.IContainer.Resolve* call is made, the algorithm
will first attempt to select the greediest constructor whose parameters are <em>completely</em>
satisfied by those registered services.  Thus, if a class has a constructor with one parameter and one with ten; if the single
parameter can be successfully injected but only nine of the others can be, then the single parameter constructor wins:</p>
<div class="NOTE"><h5>Note</h5><p>Parameters with default values are treated as being &#39;satisfied&#39; even if the service is not registered, so if our ten-parameter
constructor overload had nine optional parameters with defaults, and the same first parameter, then it would win.</p>
<p>If there&#39;s a tie on the number of satisfied arguments between two constructors which have one or more optional parameters 
with default values, then the one which will require the use of the fewest default values wins.</p>
</div>
<p>If, however, none of the constructors can be completely satisfied, then we look for the greediest constructor with the most
number of resolved arguments.  If there&#39;s a clear winner, then we proceed with that constructor anyway even though one or
more required services are missing.  This is to allow child containers (documentation pending) to plug the gap for these
other services.</p>
<h3 id="named-argument-binding">Named argument binding</h3>
<p>When using best-match, you can also supply a dictionary of named argument bindings (as a dictionary of <a class="xref" href="../../api/Rezolver.ITarget.html">ITarget</a>s)
which can be used to provide a hint as to your preferred constructor.  You don&#39;t need to provide all named arguments, just those
for which </p>
<h2 id="simple-scenarios">Simple scenarios</h2>

            </article>
          </div>
          
          <div class="hidden-sm col-md-2" role="complementary">
            <div class="sideaffix">
              <div class="contribution">
                <ul class="nav">
                  <li>
                    <a href="https://github.com/ZolutionSoftware/Rezolver/blob/dev/doc/Rezolver.Documentation/_docfx_proj/docs/registering-services/constructors.md/#L1" class="contribution-link">Improve this Doc</a>
                  </li>
                </ul>
              </div>
              <nav class="bs-docs-sidebar hidden-print hidden-xs hidden-sm affix" id="affix">
              <!-- <p><a class="back-to-top" href="#top">Back to top</a><p> -->
              </nav>
            </div>
          </div>
        </div>
      </div>
      
      <footer>
      	<div class="container packageDetails notyetreleased">This documentation is for package version 1.1.71702.100 which is not yet released.  It's nearly complete though, so hold tight!</div>
      
        <div class="grad-bottom"></div>
        <div class="footer">
          <div class="container">
            <span class="pull-right">
              <a href="#top">Back to top</a>
            </span>
            <span>Copyright &copy;2015 onwards <a href="http://www.zolution.co.uk" target="_blank">Zolution Software Ltd</a><br>Generated by <a href="https://dotnet.github.io/docfx/" target="_blank">DocFX</a>, with the Rezolver theme</span>
            
          </div>
        </div>
      </footer>
    </div>
    
    <script type="text/javascript" src="../../styles/docfx.vendor.js"></script>
    <script type="text/javascript" src="../../styles/docfx.js"></script>
    <script type="text/javascript" src="../../styles/main.js"></script>
  </body>
</html>
