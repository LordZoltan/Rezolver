<!DOCTYPE html>
<!--[if IE]><![endif]-->
<html>
  
  <head>
  	<meta charset="utf-8">
  	<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
  	<title>Rezolver.Microsoft.AspNetCore.Hosting Package | Rezolver IOC </title>
  	<meta name="viewport" content="width=device-width">
  	<meta name="title" content="Rezolver.Microsoft.AspNetCore.Hosting Package | Rezolver IOC ">
  	<meta name="generator" content="docfx 2.40.1.0">
  	<meta name="description" content="Rezolver is the portable open-source IOC container framework for .Net - built from the ground up for .Net Core, Asp.Net Core, and also optimised for the 'full .Net' :)">
  	<link rel="shortcut icon" href="../../favicon.ico">
  	<link rel="stylesheet" href="../../styles/docfx.vendor.css">
  	<link rel="stylesheet" href="../../styles/docfx.css">
  	<link rel="stylesheet" href="../../styles/main.css">
  	<meta property="docfx:navrel" content="../../toc.html">
  	<meta property="docfx:tocrel" content="../toc.html">
  	
  	<meta property="docfx:rel" content="../../">
  	
  		<link rel="apple-touch-icon" sizes="57x57" href="../../../apple-touch-icon-57x57.png">
  		<link rel="apple-touch-icon" sizes="60x60" href="../../../apple-touch-icon-60x60.png">
  		<link rel="apple-touch-icon" sizes="72x72" href="../../../apple-touch-icon-72x72.png">
  		<link rel="apple-touch-icon" sizes="76x76" href="../../../apple-touch-icon-76x76.png">
  		<link rel="apple-touch-icon" sizes="114x114" href="../../../apple-touch-icon-114x114.png">
  		<link rel="apple-touch-icon" sizes="120x120" href="../../../apple-touch-icon-120x120.png">
  		<link rel="apple-touch-icon" sizes="144x144" href="../../../apple-touch-icon-144x144.png">
  		<link rel="apple-touch-icon" sizes="152x152" href="../../../apple-touch-icon-152x152.png">
  		<link rel="apple-touch-icon" sizes="180x180" href="../../../apple-touch-icon-180x180.png">
  		<link rel="icon" type="image/png" href="../../../favicon-32x32.png" sizes="32x32">
  		<link rel="icon" type="image/png" href="../../../android-chrome-192x192.png" sizes="192x192">
  		<link rel="icon" type="image/png" href="../../../favicon-96x96.png" sizes="96x96">
  		<link rel="icon" type="image/png" href="../../../favicon-16x16.png" sizes="16x16">
  		<link rel="manifest" href="../../../manifest.json">
  		<link rel="mask-icon" href="../../../safari-pinned-tab.svg" color="#5bbad5">
  		<meta name="msapplication-TileColor" content="#da532c">
  		<meta name="msapplication-TileImage" content="../../../mstile-144x144.png">
  		<meta name="theme-color" content="#ffffff">
  </head>
  <body data-spy="scroll" data-target="#affix" data-offset="120">
    <div id="wrapper">
      <header>
        
        <nav id="autocollapse" class="navbar navbar-inverse ng-scope" role="navigation">
          <div class="container">
            <div class="navbar-header">
              <button type="button" class="navbar-toggle" data-toggle="collapse" data-target="#navbar">
                <span class="sr-only">Toggle navigation</span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
              </button>
              
              <a class="navbar-brand" href="../../index.html">
                <img id="logo" class="svg" src="../../../content/rz_square_white_on_orange_48x48.png" alt="">
              </a>
            </div>
            <div class="collapse navbar-collapse" id="navbar">
        		<p class="navbar-text navbar-right github-link"><a href="http://github.com/ZolutionSoftware/Rezolver" target="_blank" title="See this project on Github"><span class="fa fa-github"></span></a></p>
        		<form class="navbar-form navbar-right" role="search" id="search">
        		<div class="form-group">
        			<input type="text" class="form-control" id="search-query" placeholder="Search" autocomplete="off">
        		</div>
        		</form>
        		<p class="navbar-text navbar-right">
        			<a href="https://www.nuget.org/packages/Rezolver" target="_blank"><img src="//img.shields.io/nuget/v/Rezolver.svg?style=plastic&amp;maxage=480" title="Get the Nuget Package"></a>
        			<a href="http://waffle.io/ZolutionSoftware/Rezolver" title="Open the Waffleboard for this project" target="_blank"><img alt="Work in Progress" src="https://badge.waffle.io/ZolutionSoftware/Rezolver.png?label=in%20progress&title=In%20Progress"></a>
        			<!-- <a href="http://waffle.io/ZolutionSoftware/Rezolver" title="Open the Waffleboard for this project" target="_blank"><img alt="Work prepared" src="https://badge.waffle.io/ZolutionSoftware/Rezolver.png?label=ready&title=Ready"></img></a> -->
        		</p>
            </div>
          </div>
        </nav>
        
        <div class="subnav navbar navbar-default">
          <div class="container hide-when-search" id="breadcrumb">
            <ul class="breadcrumb">
              <li></li>
            </ul>
          </div>
        </div>
      </header>
      <div class="container body-content">
        
        <div id="search-results">
          <div class="search-list"></div>
          <div class="sr-items">
            <p><i class="glyphicon glyphicon-refresh index-loading"></i></p>
          </div>
          <ul id="pagination"></ul>
        </div>
      </div>
      <div role="main" class="container body-content hide-when-search">
        
        <div class="sidenav hide-when-search">
          <a class="btn toc-toggle collapse" data-toggle="collapse" href="#sidetoggle" aria-expanded="false" aria-controls="sidetoggle">Show / Hide Table of Contents</a>
          <div class="sidetoggle collapse" id="sidetoggle">
            <div id="sidetoc"></div>
          </div>
        </div>
        <div class="article row grid-right">
          <div class="col-md-10">
            <article class="content wrap" id="_content" data-uid="">
<h1 id="rezolvermicrosoftaspnetcorehosting-package">Rezolver.Microsoft.AspNetCore.Hosting Package</h1>

<p>This builds on the <a href="rezolver.microsoft.extensions.dependencyinjection.html">Rezolver.Microsoft.Extensions.DependencyInjection</a>
package to enable the integration of Rezolver into your Asp.Net Core site somewhat earlier in its startup phase.</p>
<p><a href="https://www.nuget.org/packages/Rezolver.Microsoft.AspNetCore.Hosting">See package page on nuget</a>.</p>
<p>Rezolver integration is available for both Asp.Net Core 1.1 and 2.0, with the Asp.Net Core 2.0 
integration offering more flexibility as it allows you to perform configuration on the container(s) that
are created before any registrations are made.</p>
<h1 id="aspnet-core-2120">Asp.Net Core 2.1/2.0</h1>
<p>Version <code>2.1</code> of the package supports Asp.Net Core 2.1; <code>2.0</code> supports Asp.Net Core 2.0.</p>
<h2 id="programcs-changes">Program.cs changes</h2>
<p>After adding the package, change your <code>program.cs</code> file so it looks like this:</p>
<pre><code class="lang-csharp" name="Example.cs">public class Program
{
    public static void Main(string[] args)
    {
        BuildWebHost(args).Run();
    }

    public static IWebHost BuildWebHost(string[] args) =&gt;
        WebHost.CreateDefaultBuilder(args)
            .UseRezolver()
            .UseStartup&lt;Startup&gt;()
            .Build();

    // NOTE - you can also pass a configuration callback to UseRezolver(), e.g:

    /*  
     *  .UseRezolver(o =&gt;
     *  {
     *      // Example of disabling contravariance
     *      o.TargetContainerConfig.ConfigureOption&lt;EnableContravariance&gt;(false);
     *
     *      // you can also add configuration to the container configuration via 
     *      // the ContainerConfig property (e.g. change compilers).
     *  })
     */
}
</code></pre><p>So, at the most basic level you just call the 
<a class="xref" href="../../api/Microsoft.AspNetCore.Hosting.RezolverServiceProviderWebHostBuilderExtensions.html#Microsoft_AspNetCore_Hosting_RezolverServiceProviderWebHostBuilderExtensions_UseRezolver_">UseRezolver</a> method, and that&#39;s
enough.</p>
<h3 id="configuration-call-back">Configuration call-back</h3>
<p>If you&#39;ve been reading some of the topics on this site - say, about <a href="../variance/contravariance.html">contravariance</a>
or <a href="../enumerables/lazy-vs-eager.html">lazy and eager enumerables</a> then you&#39;ll have seen how we can use options
to control complex behaviours in Rezolver containers.  That&#39;s what is shown in the alternative call
to <code>UseRezolver</code> in the commented code.  you can also pass a configuration callback that will be called
to modify the <a class="xref" href="../../api/Rezolver.RezolverOptions.html">RezolverOptions</a> that will be used to create both the <a class="xref" href="../../api/Rezolver.IRootTargetContainer.html">IRootTargetContainer</a> that
forms the basis of the registrations, and the <a class="xref" href="../../api/Rezolver.ScopedContainer.html">ScopedContainer</a> that will ultimately create the objects
for the application.</p>
<div class="NOTE"><h5>Note</h5><p>Please note that lazy enumerables are currently switched off in Rezolver&#39;s integration with Asp.Net Core
because of a mis-specification of a test by the Dependency Injection team.</p>
<p>The <a href="https://www.nuget.org/packages/Microsoft.Extensions.DependencyInjection.Specification.Tests/">specification test</a> is something
which a DI container should pass if it&#39;s intending to be used with Asp.Net Core - and unfortunately there
was one test that failed when Rezolver was using lazy enumerables - which is its default behaviour.
<a href="https://github.com/aspnet/DependencyInjection/issues/589">An issue was raised</a> on the Git repo and has 
been fixed, but it&#39;ll take a few more days/weeks before we see it in the wild.</p>
<p>We can say that if you <em>need</em> lazy enumerables, then you should be able to re-enable them and your application
will work.</p>
</div>
<h2 id="startupcs-changes">Startup.cs changes</h2>
<p>Now we need to tell the Asp.Net Core stack that you want an <a class="xref" href="../../api/Rezolver.IRootTargetContainer.html">IRootTargetContainer</a> to be created
in order to construct the <a class="xref" href="../../api/Rezolver.ScopedContainer.html">ScopedContainer</a> that will be used as the DI container.</p>
<p>The <em>simplest</em> way to do this is to add a single method (it can be empty) called <code>ConfigureContainer</code>, which 
accepts a single parameter of the type <a class="xref" href="../../api/Rezolver.IRootTargetContainer.html">IRootTargetContainer</a>.</p>
<div class="NOTE"><h5>Note</h5><p>The <a class="xref" href="../../api/Rezolver.IRootTargetContainer.html">IRootTargetContainer</a> interface was added in Rezolver 1.3.2 to accommodate covariance
and is now the interface used for &#39;top-level&#39; target containers.  You can still declare your method
as <code>ConfigureContainer&lt;ITargetContainer&gt;</code> without losing any functionality - so projects which are
upgrading from v2.0.x of the Hosting package will still work without any code changes.</p>
</div>
<pre><code class="lang-csharp" name="Startup.cs">public class Startup
{
    public Startup(IConfiguration configuration)
    {
        Configuration = configuration;
    }

    public IConfiguration Configuration { get; }

    public void ConfigureServices(IServiceCollection services)
    {
        // you need AddOptions if you intend to use the configuration callback
        // in your call to UseRezolver() in program.cs
        services.AddOptions();

        services.AddMvc();
    }

    // Adding this method (even if empty) is enough to trigger the use of Rezolver
    // as the Asp.Net Core 2 Application&#39;s DI container.
    public void ConfigureContainer(IRootTargetContainer targets)
    {
        // The targets passed here will be used to create the ScopedContainer.

        // Perform additional Rezolver-specific registrations (e.g. Decoration) here.
    }

    // This method gets called by the runtime. Use this method to configure the HTTP request pipeline.
    public void Configure(IApplicationBuilder app, IHostingEnvironment env)
    {
        if (env.IsDevelopment())
        {
            app.UseDeveloperExceptionPage();
            app.UseBrowserLink();
        }
        else
        {
            app.UseExceptionHandler(&quot;/Home/Error&quot;);
        }

        app.UseStaticFiles();

        app.UseMvc(routes =&gt;
        {
            routes.MapRoute(
                name: &quot;default&quot;,
                template: &quot;{controller=Home}/{action=Index}/{id?}&quot;);
        });
    }
}
</code></pre><div class="NOTE"><h5>Note</h5><p>Note the call to <code>AddOptions()</code> in the <code>ConfigureServices</code> method.  As the comment in the code says,
you need this if you intend to use configuration callbacks in your <code>UseRezolver</code> method call in <code>program.cs</code>.</p>
</div>
<p>By adding that <code>ConfigureContainer</code> method, a new Rezolver <a class="xref" href="../../api/Rezolver.ScopedContainer.html">ScopedContainer</a> will be created and populated
from the <code>IServiceCollection</code> that contains all the service registrations for the application.</p>
<p>As the comment states, inside that method you can also perform more configuration or registrations on the 
<a class="xref" href="../../api/Rezolver.IRootTargetContainer.html">IRootTargetContainer</a>, such as decorators, expressions etc which are not supported by Microsoft&#39;s DI
abstractions, before the target container is passed to a new <a class="xref" href="../../api/Rezolver.ScopedContainer.html">ScopedContainer</a> that will then be
used as the application&#39;s <code>IServiceProvider</code>.</p>
<p>And that&#39;s it - your application is configured.</p>
<h1 id="aspnet-core-11">Asp.Net Core 1.1</h1>
<p>Version <code>1.3</code> is the latest version of the package that supports Asp.Net Core 1.1.  The setup is fundamentally
identical, except the <code>UseRezolver</code> method does not accept any callbacks.</p>
<pre><code class="lang-csharp" name="Example.cs">public class Program
{
    public static void Main(string[] args)
    {
        var host = new WebHostBuilder()
            //add the Rezolver container to the host builder
            .UseRezolver()
            .UseKestrel()
            .UseContentRoot(Directory.GetCurrentDirectory())
            .UseIISIntegration()
            .UseStartup&lt;Startup&gt;()
            .Build();

        host.Run();
    }
}
</code></pre><p>The <code>startup.cs</code> is similar to what&#39;s required for Asp.Net Core 2.0 - except your <code>ConfigureContainer</code>
method should accept an <code>ITargetContainer</code> - i.e. <code>ConfigureContainer(ITargetContainer)</code>
and then Rezolver will be used as the container for your application.</p>
<hr>
<p>Clearly, we recommmend moving to Asp.Net Core 2.0 ASAP as it has more features, is faster, and is generally 
<em>way</em> cooler than 1.1! <span class="emoji" shortcode="wink">😉</span></p>
</article>
          </div>
          
          <div class="hidden-sm col-md-2" role="complementary">
            <div class="sideaffix">
              <div class="contribution">
                <ul class="nav">
                  <li>
                    <a href="https://github.com/ZolutionSoftware/Rezolver/blob/autofactories/doc/Rezolver.Documentation/_docfx_proj/docs/nuget-packages/rezolver.microsoft.aspnetcore.hosting.md/#L1" class="contribution-link">Improve this Doc</a>
                  </li>
                </ul>
              </div>
              <nav class="bs-docs-sidebar hidden-print hidden-xs hidden-sm affix" id="affix">
              <!-- <p><a class="back-to-top" href="#top">Back to top</a><p> -->
              </nav>
            </div>
          </div>
        </div>
      </div>
      
      <footer>
        <div class="footer">
          <div class="container">
            <span class="pull-right">
              <a href="#top">Back to top</a>
            </span>
            <span>Copyright &copy;2014 onwards <a href="http://www.zolution.co.uk" target="_blank">Zolution Software Ltd</a><br>Generated by <a href="https://dotnet.github.io/docfx/" target="_blank">DocFX</a>, with the Rezolver theme</span>
            
          </div>
        </div>
      </footer>
    </div>
    
    <script type="text/javascript" src="../../styles/docfx.vendor.js"></script>
    <script type="text/javascript" src="../../styles/docfx.js"></script>
    <script type="text/javascript" src="../../styles/main.js"></script>
  </body>
</html>
