<!DOCTYPE html>
<!--[if IE]><![endif]-->
<html>
  
  <head>
  	<meta charset="utf-8">
  	<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
  	<title>Decorators | Rezolver IOC </title>
  	<meta name="viewport" content="width=device-width">
  	<meta name="title" content="Decorators | Rezolver IOC ">
  	<meta name="generator" content="docfx 2.24.0.0">
  	<meta name="description" content="Rezolver is the portable open-source IOC container framework for .Net - built from the ground up for .Net Core, Asp.Net Core, and also optimised for the 'full .Net' :)">
  	<link rel="shortcut icon" href="../favicon.ico">
  	<link rel="stylesheet" href="../styles/docfx.vendor.css">
  	<link rel="stylesheet" href="../styles/docfx.css">
  	<link rel="stylesheet" href="../styles/main.css">
  	<meta property="docfx:navrel" content="../toc.html">
  	<meta property="docfx:tocrel" content="toc.html">
  	<meta property="docfx:rel" content="../">
  	
  		<link rel="apple-touch-icon" sizes="57x57" href="../../apple-touch-icon-57x57.png">
  		<link rel="apple-touch-icon" sizes="60x60" href="../../apple-touch-icon-60x60.png">
  		<link rel="apple-touch-icon" sizes="72x72" href="../../apple-touch-icon-72x72.png">
  		<link rel="apple-touch-icon" sizes="76x76" href="../../apple-touch-icon-76x76.png">
  		<link rel="apple-touch-icon" sizes="114x114" href="../../apple-touch-icon-114x114.png">
  		<link rel="apple-touch-icon" sizes="120x120" href="../../apple-touch-icon-120x120.png">
  		<link rel="apple-touch-icon" sizes="144x144" href="../../apple-touch-icon-144x144.png">
  		<link rel="apple-touch-icon" sizes="152x152" href="../../apple-touch-icon-152x152.png">
  		<link rel="apple-touch-icon" sizes="180x180" href="../../apple-touch-icon-180x180.png">
  		<link rel="icon" type="image/png" href="../../favicon-32x32.png" sizes="32x32">
  		<link rel="icon" type="image/png" href="../../android-chrome-192x192.png" sizes="192x192">
  		<link rel="icon" type="image/png" href="../../favicon-96x96.png" sizes="96x96">
  		<link rel="icon" type="image/png" href="../../favicon-16x16.png" sizes="16x16">
  		<link rel="manifest" href="../../manifest.json">
  		<link rel="mask-icon" href="../../safari-pinned-tab.svg" color="#5bbad5">
  		<meta name="msapplication-TileColor" content="#da532c">
  		<meta name="msapplication-TileImage" content="../../mstile-144x144.png">
  		<meta name="theme-color" content="#ffffff">
  	<script>
  	  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  	  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  	  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  	  })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');
  	
  	  ga('create', 'UA-92764222-1', 'auto');
  	  ga('send', 'pageview');
  	
  	</script></head>
  <body data-spy="scroll" data-target="#affix">
    <div id="wrapper">
      <header>
        
        <nav id="autocollapse" class="navbar navbar-inverse ng-scope" role="navigation">
          <div class="container">
            <div class="navbar-header">
              <button type="button" class="navbar-toggle" data-toggle="collapse" data-target="#navbar">
                <span class="sr-only">Toggle navigation</span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
              </button>
              
              <a class="navbar-brand" href="../index.html">
                <img id="logo" class="svg" src="../../content/rz_square_white_on_orange_48x48.png" alt="">
              </a>
            </div>
            <div class="collapse navbar-collapse" id="navbar">
        		<p class="navbar-text navbar-right github-link"><a href="http://github.com/ZolutionSoftware/Rezolver" target="_blank" title="See this project on Github"><span class="fa fa-github"></span></a></p>
        		<form class="navbar-form navbar-right" role="search" id="search">
        		<div class="form-group">
        			<input type="text" class="form-control" id="search-query" placeholder="Search" autocomplete="off">
        		</div>
        		</form>
        		<p class="navbar-text navbar-right">
        			<a href="https://www.nuget.org/packages/Rezolver" target="_blank"><img src="//img.shields.io/nuget/v/Rezolver.svg?style=plastic&amp;maxage=480" title="Get the Nuget Package"></a>
        			<a href="http://waffle.io/ZolutionSoftware/Rezolver" title="Open the Waffleboard for this project" target="_blank"><img alt="Work in Progress" src="https://badge.waffle.io/ZolutionSoftware/Rezolver.png?label=in%20progress&title=In%20Progress"></a>
        			<!-- <a href="http://waffle.io/ZolutionSoftware/Rezolver" title="Open the Waffleboard for this project" target="_blank"><img alt="Work prepared" src="https://badge.waffle.io/ZolutionSoftware/Rezolver.png?label=ready&title=Ready"></img></a> -->
        		</p>
            </div>
          </div>
        </nav>
        
        <div class="subnav navbar navbar-default">
          <div class="container hide-when-search" id="breadcrumb">
            <ul class="breadcrumb">
              <li></li>
            </ul>
          </div>
        </div>
      </header>
      <div class="container body-content">
        
        <div id="search-results">
          <div class="search-list"></div>
          <div class="sr-items"></div>
          <ul id="pagination"></ul>
        </div>
      </div>
      <div role="main" class="container body-content hide-when-search">
        
        <div class="sidenav hide-when-search">
          <a class="btn toc-toggle collapse" data-toggle="collapse" href="#sidetoggle" aria-expanded="false" aria-controls="sidetoggle">Show / Hide Table of Contents</a>
          <div class="sidetoggle collapse" id="sidetoggle">
            <div id="sidetoc"></div>
          </div>
        </div>
        <div class="article row grid-right">
          <div class="col-md-10">
            <article class="content wrap" id="_content" data-uid="">
<h1 id="decorators">Decorators</h1>

<p>The <a href="https://en.wikipedia.org/wiki/Decorator_pattern">decorator pattern</a> is a key part of many software projects, 
and Rezolver offers first-class support for implementing it either non-generically, or generically.</p>
<h2 id="registering-decorators-in-rezolver">Registering decorators in Rezolver</h2>
<p>Registration of Decorators in Rezolver is done through the overloaded extension method 
<a class="xref" href="../api/Rezolver.DecoratorTargetContainerExtensions.html#Rezolver_DecoratorTargetContainerExtensions_RegisterDecorator_">RegisterDecorator</a>.  There is a generic and non-generic version
(as is typical for nearly all Rezolver registration functions), but, unlike many other target types,
there is no factory method in the <a class="xref" href="../api/Rezolver.Target.html">Target</a> static class to create one on its own.</p>
<p>The sharp-eyed developer will be confused by this omission, especially since the type 
<a class="xref" href="../api/Rezolver.Targets.DecoratorTarget.html">DecoratorTarget</a> is a key part of Rezolver&#39;s implementation of decorators - but if 
you read the summary notes about that class, it should be apparent why: Decoration isn&#39;t <em>solely</em> 
implemented through an <a class="xref" href="../api/Rezolver.ITarget.html">ITarget</a> implementation, it also needs a special target container 
type in which that target will be registered -<br><a class="xref" href="../api/Rezolver.DecoratingTargetContainer.html">DecoratingTargetContainer</a>, the creation of which is handled automatically by the 
<a class="xref" href="../api/Rezolver.DecoratorTargetContainerExtensions.html#Rezolver_DecoratorTargetContainerExtensions_RegisterDecorator_">RegisterDecorator</a> methods.</p>
<h1 id="examples">Examples</h1>
<p>For the first few examples, we&#39;ll be using these decorators for the interface <code>IMyService</code>, which 
has also been used in many of the other examples.  If you&#39;ve already looked at the 
<a href="enumerables.html">enumerable examples</a> then you&#39;ll be familiar with them:</p>
<pre><code class="lang-csharp" name="MyServiceDecorators.cs">public class MyServiceDecorator1 : IMyService
{
    public IMyService Inner { get; }
    public MyServiceDecorator1(IMyService inner)
    {
        Inner = inner;
    }
}

public class MyServiceDecorator2 : IMyService
{
    public IMyService Inner { get; }
    public MyServiceDecorator2(IMyService inner)
    {
        Inner = inner;
    }
}
</code></pre><hr>
<h2 id="single-decorator-single-service">Single decorator, single service</h2>
<p>Here, we simply register an <code>IMyService</code> implementation and one of our decorators.  We then resolve an 
instance and we should get an instance of the decorator, with the original <code>IMyService</code> as its <code>Inner</code>.</p>
<pre><code class="lang-csharp" name="DecoratorExamples.cs">var container = new Container();
container.RegisterType&lt;MyService, IMyService&gt;();
container.RegisterDecorator&lt;MyServiceDecorator1, IMyService&gt;();

var result = container.Resolve&lt;IMyService&gt;();
var decorator = Assert.IsType&lt;MyServiceDecorator1&gt;(result);

Assert.IsType&lt;MyService&gt;(decorator.Inner);
</code></pre><hr>
<h2 id="two-decorators-single-service">Two decorators, single service</h2>
<p>You can also &#39;stack&#39; decorators for a given type, meaning you can decorate the decorators:</p>
<pre><code class="lang-csharp" name="DecoratorExamples.cs">// same as before - but two decorators
// note that the order they&#39;re registered determines the order in which 
// the decoration occurs.
var container = new Container();
container.RegisterType&lt;MyService, IMyService&gt;();
container.RegisterDecorator&lt;MyServiceDecorator2, IMyService&gt;();
container.RegisterDecorator&lt;MyServiceDecorator1, IMyService&gt;();

var result = container.Resolve&lt;IMyService&gt;();
var decorator = Assert.IsType&lt;MyServiceDecorator1&gt;(result);
var innerDecorator = Assert.IsType&lt;MyServiceDecorator2&gt;(decorator.Inner);

Assert.IsType&lt;MyService&gt;(innerDecorator.Inner);
</code></pre><p>As the test shows, the decorators are applied in the order they are registered for the given type.</p>
<hr>
<h2 id="two-decorators-enumerable">Two decorators, enumerable</h2>
<p>Decorators are also applied to elements of an enumerable:</p>
<pre><code class="lang-csharp" name="DecoratorExamples.cs">var container = new Container();
// this time we&#39;ll register the decorators first, not because
// we have to, but because we can :)
container.RegisterDecorator&lt;MyServiceDecorator2, IMyService&gt;();
container.RegisterDecorator&lt;MyServiceDecorator1, IMyService&gt;();

// note: this array of types is purely to simplify the asserts
// used at the end.
var serviceTypes = new[] {
    typeof(MyService1), typeof(MyService2),
    typeof(MyService3), typeof(MyService4),
    typeof(MyService5), typeof(MyService6)
};

var serviceTargets = serviceTypes.Select(
    t =&gt; Target.ForType(t)
);

// another way to bulk-register multiple targets
// against the same service type.  
container.RegisterMultiple(serviceTargets, typeof(IMyService));

var result = container.Resolve&lt;IEnumerable&lt;IMyService&gt;&gt;();

Assert.All(serviceTypes.Zip(result, (t, s) =&gt; (type: t, service: s)),
    ts =&gt; {
        var decorator = Assert.IsType&lt;MyServiceDecorator1&gt;(ts.service);
        var innerDecorator = Assert.IsType&lt;MyServiceDecorator2&gt;(decorator.Inner);
        Assert.IsType(ts.type, innerDecorator.Inner);
    });
</code></pre><hr>
<h2 id="open-generic-decorator">Open Generic Decorator</h2>
<p>You can also use decorators with open generics - register them just like <a href="constructor-injection/generics.html">normal generic types</a>, except
via the <a class="xref" href="../api/Rezolver.DecoratorTargetContainerExtensions.html#Rezolver_DecoratorTargetContainerExtensions_RegisterDecorator_">RegisterDecorator</a> method.</p>
<p>For this, our basic generic decorator is this:</p>
<pre><code class="lang-csharp" name="MyServiceDecorators.cs">public class UsesAnyServiceDecorator&lt;TAnyService&gt; : IUsesAnyService&lt;TAnyService&gt;
{
    public IUsesAnyService&lt;TAnyService&gt; Inner { get; }

    public UsesAnyServiceDecorator(IUsesAnyService&lt;TAnyService&gt; inner)
    {
        Inner = inner;
    }

    public void UseTheService(TAnyService service)
    {
        throw new NotImplementedException();
    }
}
</code></pre><p>And the code to register it shouldn&#39;t be too much of a surprise:</p>
<pre><code class="lang-csharp" name="DecoratorExamples.cs">var container = new Container();
container.RegisterType(typeof(UsesAnyService&lt;&gt;), typeof(IUsesAnyService&lt;&gt;));
container.RegisterDecorator(typeof(UsesAnyServiceDecorator&lt;&gt;), typeof(IUsesAnyService&lt;&gt;));

var result = container.Resolve&lt;IUsesAnyService&lt;MyService&gt;&gt;();

var decorator = Assert.IsType&lt;UsesAnyServiceDecorator&lt;MyService&gt;&gt;(result);
Assert.IsType&lt;UsesAnyService&lt;MyService&gt;&gt;(decorator.Inner);
</code></pre><div class="TIP"><h5>Tip</h5><p>Enumerables of open generics can also be decorated in a similar way to the previous example. Just register multiple 
<code>IService&lt;&gt;</code> registrations, then one or more open generic decorators as normal - then an <code>IEnumerable&lt;IService&lt;Foo&gt;&gt;</code> 
will produce an enumerable with each element correctly decorated.</p>
</div>
<hr>
<h2 id="mixing-open-generic-and-closed-decorators">Mixing Open Generic and Closed Decorators</h2>
<div class="NOTE"><h5>Note</h5><p>This is new in v1.2 after <a href="https://github.com/ZolutionSoftware/Rezolver/issues/27">this issue</a> was fixed.</p>
</div>
<p>Given a type <code>Foo&lt;T&gt; : IFoo&lt;T&gt;</code> which will be resolved by interface, e.g: <code>IFoo&lt;Bar&gt;</code>, there are two ways in which
we can decorate it:</p>
<ul>
<li>By registering a decorator for <code>IFoo&lt;Bar&gt;</code></li>
<li>By registering a decorator for the open generic <code>IFoo&lt;&gt;</code></li>
</ul>
<p>Resolver allows you to mix both approaches, so that you can have one or more catch-all decorators for the open generic, as well
as decorators for specific closed versions of that generic.  When Resolver produces the underlying instance, it will be decorated
with each decorator that applies for the type:</p>
<pre><code class="lang-csharp" name="DecoratorExamples.cs">var container = new Container();
container.RegisterType(typeof(UsesAnyService&lt;&gt;), typeof(IUsesAnyService&lt;&gt;));
container.RegisterDecorator(typeof(UsesAnyServiceDecorator&lt;&gt;), typeof(IUsesAnyService&lt;&gt;));
// this decorator only kicks in when resolving IUsesAnyService&lt;MyService2&gt;
container.RegisterDecorator&lt;UsesMyService2Decorator, IUsesAnyService&lt;MyService2&gt;&gt;();

// will be decorated twice
var redecorated = container.Resolve&lt;IUsesAnyService&lt;MyService2&gt;&gt;();
// but this will be decorated once
var decorated = container.Resolve&lt;IUsesAnyService&lt;MyService1&gt;&gt;();

Assert.IsType&lt;UsesMyService2Decorator&gt;(redecorated);
Assert.IsType&lt;UsesAnyServiceDecorator&lt;MyService2&gt;&gt;(
    ((UsesMyService2Decorator)redecorated).Inner);

// but the IUsesAnyService&lt;MyService1&gt; will only be decorated once
Assert.IsType&lt;UsesAnyServiceDecorator&lt;MyService1&gt;&gt;(decorated);

</code></pre><p>In the above example, we create a registration for the interface <code>IUsesAnyService&lt;&gt;</code>, and then <em><em>two</em></em> decorators: the first 
also for <code>IUsesAnyService&lt;&gt;</code> and a second which only applies to <code>IUsesAnyService&lt;MyService2&gt;</code>.</p>
<p>We then resolve two instances - an <code>IUsesAnyService&lt;MyService2&gt;</code>, which is decorated twice, and an instance of 
<code>IUsesAnyService&lt;MyService1&gt;</code>, which is decorated only once.</p>
<h3 id="ordering-of-open-and-closed-generic-decorators">Ordering of Open and Closed Generic Decorators</h3>
<p>When mixing open and closed generic decorators, the decorators are always applied in the order they are registered, regardless of
whether the decorator is registered against the closed or open generic.</p>
<p>So if you register decorators for the following types:</p>
<ol>
<li><code>IFoo&lt;&gt;</code></li>
<li><code>IFoo&lt;Bar&gt;</code></li>
<li><code>IFoo&lt;&gt;</code></li>
</ol>
<p>An instance of <code>IFoo&lt;Bar&gt;</code> will be decorated by all three in that same order, whereas an instance of <code>IFoo&lt;Baz&gt;</code> will only 
be decorated by decorators 1 and 3, in that order.</p>
<p>The following example demonstrates the <code>IFoo&lt;Bar&gt;</code> scenario, for completeness:</p>
<pre><code class="lang-csharp" name="DecoratorExamples.cs">var container = new Container();
container.RegisterType(typeof(UsesAnyService&lt;&gt;), typeof(IUsesAnyService&lt;&gt;));
container.RegisterDecorator(typeof(UsesAnyServiceDecorator&lt;&gt;), typeof(IUsesAnyService&lt;&gt;));
//register the special decorator for IUsesAnyService&lt;MyService2&gt; again
container.RegisterDecorator&lt;UsesMyService2Decorator, IUsesAnyService&lt;MyService2&gt;&gt;();
container.RegisterDecorator(typeof(UsesAnyServiceDecorator2&lt;&gt;), typeof(IUsesAnyService&lt;&gt;));

var reredecorated = Assert.IsType&lt;UsesAnyServiceDecorator2&lt;MyService2&gt;&gt;(
    container.Resolve&lt;IUsesAnyService&lt;MyService2&gt;&gt;());

var redecorated = Assert.IsType&lt;UsesMyService2Decorator&gt;(reredecorated.Inner);
var decorated = Assert.IsType&lt;UsesAnyServiceDecorator&lt;MyService2&gt;&gt;(redecorated.Inner);
</code></pre></article>
          </div>
          
          <div class="hidden-sm col-md-2" role="complementary">
            <div class="sideaffix">
              <div class="contribution">
                <ul class="nav">
                  <li>
                    <a href="https://github.com/ZolutionSoftware/Rezolver/blob/dev/doc/Rezolver.Documentation/_docfx_proj/docs/decorators.md/#L1" class="contribution-link">Improve this Doc</a>
                  </li>
                </ul>
              </div>
              <nav class="bs-docs-sidebar hidden-print hidden-xs hidden-sm affix" id="affix">
              <!-- <p><a class="back-to-top" href="#top">Back to top</a><p> -->
              </nav>
            </div>
          </div>
        </div>
      </div>
      
      <footer>
        <div class="footer">
          <div class="container">
            <span class="pull-right">
              <a href="#top">Back to top</a>
            </span>
            <span>Copyright &copy;2014 onwards <a href="http://www.zolution.co.uk" target="_blank">Zolution Software Ltd</a><br>Generated by <a href="https://dotnet.github.io/docfx/" target="_blank">DocFX</a>, with the Rezolver theme</span>
            
          </div>
        </div>
      </footer>
    </div>
    
    <script type="text/javascript" src="../styles/docfx.vendor.js"></script>
    <script type="text/javascript" src="../styles/docfx.js"></script>
    <script type="text/javascript" src="../styles/main.js"></script>
  </body>
</html>
